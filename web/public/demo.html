<!DOCTYPE html>
<html lang="en" height="100%" width="100%">

<head>
    <meta charset="UTF-8">
    <title>ImJoy Web App</title>
    <script src="./imjoy-lib.js"></script>
    <link rel="stylesheet" href="https://static.imjoy.io/spectre.css/spectre.min.css">
    <link rel="stylesheet" href="https://static.imjoy.io/spectre.css/spectre-exp.min.css">
    <link rel="stylesheet" href="https://static.imjoy.io/spectre.css/spectre-icons.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.15.3/axios.min.js"></script>
    <style>
        .whiteboard{
            width: 100%;
            height: 100%;
        }
        .window_container{
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body height="100%" width="100%">
    <header class="navbar">
        <section class="navbar-section">
            <a href="https://imjoy.io"  class="navbar-brand mr-2" target="_blank" class="btn btn-link">ImJoy</a>
        </section>
        <section class="navbar-center">
            <!-- centered logo or brand -->
            <button class="btn btn-primary" onclick="addWindow('Test', 1)">Add window</button>
            <button class="btn btn-primary" onclick="openDialog()">Show Dialog</button>
        </section>
        <section class="navbar-section">
            <a href="https://imjoy.io/docs" target="_blank" class="btn btn-link">Docs</a>
        </section>
    </header>
    <div class="modal" id="window-dialog-container">
        <a href="#close" class="modal-overlay" aria-label="Close"></a>
        <div class="modal-container">
            <div class="modal-header">
                <a href="#close" class="btn btn-clear float-right" aria-label="Close"
                    onclick="closeDialog('window-dialog-container')"></a>
                <div class="modal-title h5" id="window-dialog-title">Dialog</div>
            </div>
            <div class="modal-body">
                <div class="content">
         
                </div>
            </div>
        </div>
    </div>
    <ul class="tab tab-block whiteboard" id="whiteboard">

    </ul>

    <script>
        var selected_window = null
        var imjoy_api = {}
        function openDialog() {
            document.getElementById('window-dialog-container').classList.add('active')
        }
        function closeDialog() {
            document.getElementById('window-dialog-container').classList.remove('active')
        }
        function addWindow(title, id){
            document.getElementById('whiteboard').innerHTML +=`
            <li class="tab-item" id="window_${id}">
                <a href="#" onclick="selectWindow('${id}')">${title}</a>
                <div class="window_container" id="${id}"></div>
            </li>`
        }
        function selectWindow(id){
            if(document.getElementById(selected_window)){
                document.getElementById(selected_window).style.display = "none";
                document.getElementById('window_'+selected_window).classList.remove('active')
            }
            selected_window = id;
            document.getElementById(id).style.display = "block";
            document.getElementById('window_'+id).classList.add('active')
        }
        function removeWindow(id){
            document.getElementById('whiteboard').removeChild(document.getElementById('window_'+id));
        }

    
        document.addEventListener('DOMContentLoaded', (event) => {
            addWindow('Test', '10')
            var imjoy = new imjoyLib.ImJoy({
                imjoy_api: imjoy_api,
                show_message_callback: console.log,
                show_engine_callback: console.log,
                add_window_callback: async (w)=>{
                    this.addWindow(w.name, w.iframe_container)
                },
                update_ui_callback: ()=>{}
            })
            imjoy.start().then(()=>{
                console.log(imjoy)
                axios.get('https://raw.githubusercontent.com/oeway/ImJoy-Plugins/master/repository/ImageAnnotator.imjoy.html').then((response)=>{
                    imjoy.pm.reloadPlugin({code: response.data}).then((plugin)=>{
                        plugin.api.run()
                    })
                })
                
            })
            .catch((e)=>{
                console.error(e)
                alert('Error: '+ e)
            })
        })
    </script>
</body>

</html>